<!-- src/app/features/deals/deal-form/deal-form.component.html -->
<div class="deal-form-container">
  
  <!-- Page Header -->
  <div class="page-header">
    <div class="header-left">
      <h1>{{ isEditMode ? ' Edit Deal' : ' Create New Deal' }}</h1>
      <p>{{ isEditMode ? 'Update deal information' : 'Add a new deal to the pipeline' }}</p>
    </div>
  </div>

  <!-- Form Card -->
  <form [formGroup]="dealForm" (ngSubmit)="onSubmit()">
    <div class="form-card">
      
      <!-- Basic Information Section -->
      <div class="form-section">
        <h3 class="section-title">
          <i class="fas fa-info-circle"></i>
          <span>Basic Information</span>
        </h3>
        
        <div class="form-grid">
          <div class="form-group">
            <label>Deal Title *</label>
            <input 
              type="text" 
              formControlName="title"
              class="form-control"
              [class.invalid]="isFieldInvalid('title')"
              placeholder="e.g., ABC Corporation - Elevator Installation"
            />
            <span class="error-message" *ngIf="isFieldInvalid('title')">
              {{ getErrorMessage('title') }}
            </span>
          </div>

          <div class="form-group">
            <label>Company Name *</label>
            <input 
              type="text" 
              formControlName="company"
              class="form-control"
              [class.invalid]="isFieldInvalid('company')"
              placeholder="Enter company name"
            />
            <span class="error-message" *ngIf="isFieldInvalid('company')">
              {{ getErrorMessage('company') }}
            </span>
          </div>

          <div class="form-group">
            <label>Contact Person *</label>
            <input 
              type="text" 
              formControlName="contactPerson"
              class="form-control"
              [class.invalid]="isFieldInvalid('contactPerson')"
              placeholder="Enter contact person name"
            />
            <span class="error-message" *ngIf="isFieldInvalid('contactPerson')">
              {{ getErrorMessage('contactPerson') }}
            </span>
          </div>

          <div class="form-group">
            <label>Email *</label>
            <input 
              type="email" 
              formControlName="email"
              class="form-control"
              [class.invalid]="isFieldInvalid('email')"
              placeholder="contact@example.com"
            />
            <span class="error-message" *ngIf="isFieldInvalid('email')">
              {{ getErrorMessage('email') }}
            </span>
          </div>

          <div class="form-group">
            <label>Phone *</label>
            <input 
              type="tel" 
              formControlName="phone"
              class="form-control"
              [class.invalid]="isFieldInvalid('phone')"
              placeholder="+91 9876543210"
            />
            <span class="error-message" *ngIf="isFieldInvalid('phone')">
              {{ getErrorMessage('phone') }}
            </span>
          </div>

          <div class="form-group">
            <label>Lead Source *</label>
            <select 
              formControlName="leadSource"
              class="form-control"
              [class.invalid]="isFieldInvalid('leadSource')"
            >
              <option value="">Select lead source...</option>
              <option *ngFor="let source of leadSources" [value]="source.value">
                {{ source.label }}
              </option>
            </select>
            <span class="error-message" *ngIf="isFieldInvalid('leadSource')">
              {{ getErrorMessage('leadSource') }}
            </span>
          </div>
        </div>
      </div>

      <!-- Deal Details Section -->
      <div class="form-section">
        <h3 class="section-title">
          <i class="fas fa-building"></i>
          <span>Deal Details</span>
        </h3>
        
        <div class="elevator-type-grid">
          <div 
            *ngFor="let type of elevatorTypes"
            class="type-card"
            [class.selected]="dealForm.get('elevatorType')?.value === type.value"
            (click)="dealForm.patchValue({ elevatorType: type.value }); calculateEstimate()"
          >
            <div class="type-icon">{{ type.icon }}</div>
            <div class="type-label">{{ type.label }}</div>
          </div>
        </div>
        <span class="error-message" *ngIf="isFieldInvalid('elevatorType')">
          {{ getErrorMessage('elevatorType') }}
        </span>

        <div class="form-grid" style="margin-top: 25px;">
          <div class="form-group">
            <label>Number of Floors *</label>
            <input 
              type="number" 
              formControlName="floors"
              class="form-control"
              [class.invalid]="isFieldInvalid('floors')"
              placeholder="8"
              min="1"
              (change)="calculateEstimate()"
            />
            <span class="error-message" *ngIf="isFieldInvalid('floors')">
              {{ getErrorMessage('floors') }}
            </span>
          </div>

          <div class="form-group">
            <label>Quantity *</label>
            <input 
              type="number" 
              formControlName="quantity"
              class="form-control"
              [class.invalid]="isFieldInvalid('quantity')"
              placeholder="1"
              min="1"
              (change)="calculateEstimate()"
            />
            <span class="error-message" *ngIf="isFieldInvalid('quantity')">
              {{ getErrorMessage('quantity') }}
            </span>
          </div>

          <div class="form-group">
            <label>Deal Amount (â‚¹) *</label>
            <input 
              type="number" 
              formControlName="amount"
              class="form-control"
              [class.invalid]="isFieldInvalid('amount')"
              placeholder="1800000"
              min="0"
            />
            <span class="error-message" *ngIf="isFieldInvalid('amount')">
              {{ getErrorMessage('amount') }}
            </span>
            <button 
              type="button" 
              class="btn-calculate"
              (click)="calculateEstimate()"
            >
              <i class="fas fa-calculator"></i>
              <span>Auto Calculate</span>
            </button>
          </div>

          <div class="form-group" *ngIf="dealForm.get('amount')?.value">
            <label>Estimated Value</label>
            <div class="estimated-value">
              {{ formatCurrency(dealForm.get('amount')?.value) }}
            </div>
          </div>
        </div>
      </div>

      <!-- Sales Information Section -->
      <div class="form-section">
        <h3 class="section-title">
          <i class="fas fa-chart-line"></i>
          <span>Sales Information</span>
        </h3>
        
        <div class="form-grid">
          <div class="form-group">
            <label>Deal Status *</label>
            <select 
              formControlName="status"
              class="form-control"
              [class.invalid]="isFieldInvalid('status')"
            >
              <option *ngFor="let status of statusOptions" [value]="status.value">
                {{ status.label }}
              </option>
            </select>
            <span class="error-message" *ngIf="isFieldInvalid('status')">
              {{ getErrorMessage('status') }}
            </span>
          </div>

          <div class="form-group">
            <label>Probability (%) *</label>
            <input 
              type="number" 
              formControlName="probability"
              class="form-control"
              [class.invalid]="isFieldInvalid('probability')"
              placeholder="75"
              min="0"
              max="100"
            />
            <div class="probability-bar">
              <div 
                class="probability-fill"
                [style.width.%]="dealForm.get('probability')?.value"
              ></div>
            </div>
            <span class="error-message" *ngIf="isFieldInvalid('probability')">
              {{ getErrorMessage('probability') }}
            </span>
          </div>

          <div class="form-group">
            <label>Expected Close Date *</label>
            <input 
              type="date" 
              formControlName="expectedCloseDate"
              class="form-control"
              [class.invalid]="isFieldInvalid('expectedCloseDate')"
            />
            <span class="error-message" *ngIf="isFieldInvalid('expectedCloseDate')">
              {{ getErrorMessage('expectedCloseDate') }}
            </span>
          </div>

          <div class="form-group">
            <label>Assigned To *</label>
            <select 
              formControlName="assignedTo"
              class="form-control"
              [class.invalid]="isFieldInvalid('assignedTo')"
            >
              <option value="">Select sales person...</option>
              <option *ngFor="let person of salesTeam" [value]="person.id">
                {{ person.name }}
              </option>
            </select>
            <span class="error-message" *ngIf="isFieldInvalid('assignedTo')">
              {{ getErrorMessage('assignedTo') }}
            </span>
          </div>
        </div>
      </div>

      <!-- Additional Information Section -->
      <div class="form-section">
        <h3 class="section-title">
          <i class="fas fa-sticky-note"></i>
          <span>Additional Information</span>
        </h3>
        
        <div class="form-grid">
          <div class="form-group full-width">
            <label>Address</label>
            <textarea 
              formControlName="address"
              class="form-control"
              rows="3"
              placeholder="Enter installation address..."
            ></textarea>
          </div>

          <div class="form-group full-width">
            <label>Requirements</label>
            <textarea 
              formControlName="requirements"
              class="form-control"
              rows="3"
              placeholder="Specific requirements or specifications..."
            ></textarea>
          </div>

          <div class="form-group full-width">
            <label>Internal Notes</label>
            <textarea 
              formControlName="notes"
              class="form-control"
              rows="3"
              placeholder="Internal notes (not visible to customer)..."
            ></textarea>
          </div>
        </div>
      </div>

      <!-- Form Actions -->
      <div class="form-actions">
        <button 
          type="button" 
          class="btn-cancel"
          (click)="cancel()"
          [disabled]="isSubmitting"
        >
          <i class="fas fa-times"></i>
          <span>Cancel</span>
        </button>
        
        <button 
          type="submit" 
          class="btn-submit"
          [disabled]="dealForm.invalid || isSubmitting"
        >
          <i class="fas fa-spinner fa-spin" *ngIf="isSubmitting"></i>
          <i class="fas fa-check" *ngIf="!isSubmitting"></i>
          <span>{{ isSubmitting ? 'Saving...' : (isEditMode ? 'Update Deal' : 'Create Deal') }}</span>
        </button>
      </div>

    </div>
  </form>

</div>